<!DOCTYPE html><html lang=zh-CN><head><meta charset=utf-8><meta name=keywords content=成长,数学,语文，英语,Web前端,修养,日记><meta name=description content=这是我部署地静态博客。><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>hexo深入再学习 | 我的博客</title><meta name=generator content=hexo-theme-ayer><link rel="shortcut icon" href=/images/fire.png><link rel=stylesheet href=/dist/main.css><link rel=stylesheet href=/css/fonts/remixicon.css><link rel=stylesheet href=/css/custom.css><script src=https://cdn.staticfile.org/pace/1.2.4/pace.min.js></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css><script src=https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js></script><!-- mermaid --><style>.swal2-styled.swal2-confirm{font-size:1.6rem}</style></head></html><body><style>#loading-container{position:fixed;top:0;left:0;min-height:100vh;width:100vw;z-index:9999;display:flex;flex-direction:column;justify-content:center;align-items:center;background:#fff;text-align:center;-webkit-transition:opacity 1s ease;-moz-transition:opacity 1s ease;-o-transition:opacity 1s ease;transition:opacity 1s ease}.loading-image{width:120px;height:50px;transform:translate(-50%)}.loading-image div:nth-child(2){-webkit-animation:pacman-balls 1s linear 0s infinite;animation:pacman-balls 1s linear 0s infinite}.loading-image div:nth-child(3){-webkit-animation:pacman-balls 1s linear .33s infinite;animation:pacman-balls 1s linear .33s infinite}.loading-image div:nth-child(4){-webkit-animation:pacman-balls 1s linear .66s infinite;animation:pacman-balls 1s linear .66s infinite}.loading-image div:nth-child(5){-webkit-animation:pacman-balls 1s linear .99s infinite;animation:pacman-balls 1s linear .99s infinite}.loading-image div:first-of-type{width:0;height:0;border:25px solid #49b1f5;border-color:#b22222;border-right-color:transparent;border-radius:25px;-webkit-animation:rotate_pacman_half_up .5s 0s infinite;animation:rotate_pacman_half_up .5s 0s infinite}.loading-image div:nth-child(2){width:0;height:0;border:25px solid #49b1f5;border-color:#b22222;border-right-color:transparent;border-radius:25px;-webkit-animation:rotate_pacman_half_down .5s 0s infinite;animation:rotate_pacman_half_down .5s 0s infinite;margin-top:-50px}@-webkit-keyframes rotate_pacman_half_up{0%{transform:rotate(270deg)}50%{transform:rotate(1turn)}to{transform:rotate(270deg)}}@keyframes rotate_pacman_half_up{0%{transform:rotate(270deg)}50%{transform:rotate(1turn)}to{transform:rotate(270deg)}}@-webkit-keyframes rotate_pacman_half_down{0%{transform:rotate(90deg)}50%{transform:rotate(0)}to{transform:rotate(90deg)}}@keyframes rotate_pacman_half_down{0%{transform:rotate(90deg)}50%{transform:rotate(0)}to{transform:rotate(90deg)}}@-webkit-keyframes pacman-balls{75%{opacity:.7}to{transform:translate(-100px,-6.25px)}}@keyframes pacman-balls{75%{opacity:.7}to{transform:translate(-100px,-6.25px)}}.loading-image div:nth-child(3),.loading-image div:nth-child(4),.loading-image div:nth-child(5),.loading-image div:nth-child(6){background-color:#b22222;width:15px;height:15px;border-radius:100%;margin:2px;width:10px;height:10px;position:absolute;transform:translateY(-6.25px);top:25px;left:100px}.loading-text{margin-bottom:20vh;text-align:center;color:#2c3e50;font-size:2rem;box-sizing:border-box;padding:0 10px;text-shadow:0 2px 10px rgba(0,0,0,.2)}@media only screen and (max-width:500px){.loading-text{font-size:1.5rem}}.fadeout{opacity:0}@-webkit-keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0);transform:translate3d(0,-100%,0)}100%{opacity:1;-webkit-transform:none;transform:none}}@keyframes fadeInDown{0%{opacity:0;-webkit-transform:translate3d(0,-100%,0)}}</style><div id=loading-container><p class=loading-text>玩命加载中 . . .</p><div class=loading-image><div></div><div></div><div></div><div></div><div></div></div></div><script>setTimeout(function(){const e=document.getElementById("loading-container");e.className="fadeout",setTimeout(function(){e.style.display="none"},1e3)},1e3)</script><div class=my><a href=/ class=myA>主页 </a><a href=/archives/ class=myA>归档 </a><a href=/categories/ class=myA>分类 </a><a href=/tags/ class=myA>标签</a></div><div id=app><main class="content on"><section class=outer><article id=post-hexo深入再学习 class="article article-type-post" itemscope itemprop=blogPost data-scroll-reveal><div class=article-inner><header class="article-header hover-text"><h1 class="article-title sea-center" style=border-left:0 itemprop=name>hexo深入再学习</h1></header><div class=article-meta><a href=/2022/hexo%E6%B7%B1%E5%85%A5%E5%86%8D%E5%AD%A6%E4%B9%A0/ class=article-date><time datetime=2022-06-05T10:02:57.000Z itemprop=datePublished>2022-06-05</time> </a><a href=/2022/hexo%E6%B7%B1%E5%85%A5%E5%86%8D%E5%AD%A6%E4%B9%A0/ class=article-date>更新: <time datetime=2022-06-10T03:27:22.196Z itemprop=datePublished>2022-06-10</time></a><div class=article-category><a class=article-category-link href=/categories/web/ >web</a> / <a class=article-category-link href=/categories/web/hexo/ >hexo</a></div><div class=word_count><span class=post-time><span class=post-meta-item-icon><i class=ri-quill-pen-line></i> <span class=post-meta-item-text>字数统计:</span> <span class=post-count>4.7k</span> </span></span><span class=post-time>&nbsp; | &nbsp; <span class=post-meta-item-icon><i class=ri-book-open-line></i> <span class=post-meta-item-text>阅读时长≈</span> <span class=post-count>20 分钟</span></span></span></div></div><div class=tocbot></div><div class=article-entry itemprop=articleBody><h1 id=感谢><a href=#感谢 class=headerlink title=感谢></a>感谢</h1><p style=text-ident:2em><a target=_blank rel=noopener href=https://juejin.cn/post/6844903469669679117>hexo设计模式探索</a></p><p style=text-ident:2em><a target=_blank rel=noopener href=https://www.jianshu.com/p/56b9cb8ac2ea>node之proce模块</a></p><p style=text-ident:2em><a target=_blank rel=noopener href=https://blog.csdn.net/fangxuan1509/article/details/107469465>minimist命令行引擎</a></p><p style=text-ident:2em><a target=_blank rel=noopener href=https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/setPrototypeOf>Object.setPrototypeOf原型组合</a></p><p style=text-ident:2em><a target=_blank rel=noopener href=https://baike.baidu.com/item/%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E>模板引擎</a></p><p style=text-ident:2em><a target=_blank rel=noopener href=http://nodejs.cn/api/vm.html>nodejs vm模块</a></p><p style=text-ident:2em><a target=_blank rel=noopener href=https://www.jianshu.com/p/f935e5459c49>简书-个人学习</a></p><h1 id=主题文件夹功能探索><a href=#主题文件夹功能探索 class=headerlink title=主题文件夹功能探索></a>主题文件夹功能探索</h1><h2 id=layout><a href=#layout class=headerlink title=layout></a>layout</h2><p style=text-ident:2em><strong>ejs</strong>文件或者其他模板文件。</p><h3 id=条件函数使用><a href=#条件函数使用 class=headerlink title=条件函数使用></a>条件函数使用</h3><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>&lt;%= is_post()?&quot;class1&quot;:&quot;class2&quot; %&gt;</span><br></pre></td></tr></table></figure><h1 id=HEXO设计模式笔记><a href=#HEXO设计模式笔记 class=headerlink title=HEXO设计模式笔记></a>HEXO设计模式笔记</h1><p style=text-ident:2em>静态网站生成器以及api文档。</p><h2 id=框架特色><a href=#框架特色 class=headerlink title=框架特色></a>框架特色</h2><p style=text-ident:2em>​	nodejs运行环境，速度块，扩展能力强，插件丰富，主题开发，一键部署。</p><h2 id=盲点><a href=#盲点 class=headerlink title=盲点></a>盲点</h2><h3 id=process-argv><a href=#process-argv class=headerlink title=process.argv></a>process.argv</h3><p style=text-ident:2em>process.argv返回一个包含所有启动Nodejs的参数，第一个参数为process.execPath,第二个为当前执行js文件的路径，其它为其它命令行参数。</p><h3 id=minimist><a href=#minimist class=headerlink title=minimist></a>minimist</h3><p style=text-ident:2em>轻量级nodejs命令行解析引擎。</p><figure class="highlight javascript"><table><tr><td class=code><pre><span class=line><span class=keyword>var</span> args=<span class="title function_">minimist</span>(process.<span class=property>argv</span>.<span class="title function_">slice</span>(<span class=number>2</span>));</span><br><span class=line><span class=keyword>var</span> cmd=args.<span class=property>_</span>.<span class="title function_">shift</span>();</span><br><span class=line><span class=keyword>var</span> hexo=<span class=keyword>new</span> <span class="title class_">Hexo</span>();</span><br><span class=line>hexo.<span class="title function_">init</span>();</span><br><span class=line>hexo.<span class="title function_">call</span>(cmd,args);</span><br></pre></td></tr></table></figure><h3 id=store><a href=#store class=headerlink title=store></a>store</h3><p style=text-ident:2em>The store means a db in program.</p><p style=text-ident:2em>作者的意思大概是事件逻辑存储在store，依靠store进行耦合工作。</p><h3 id=句柄><a href=#句柄 class=headerlink title=句柄></a>句柄</h3><p style=text-ident:2em>函数的意思，或者说可以通过它来执行某些逻辑。</p><h3 id=模板引擎><a href=#模板引擎 class=headerlink title=模板引擎></a>模板引擎</h3><h3 id=node-vm><a href=#node-vm class=headerlink title="node vm"></a>node vm</h3><p style=text-ident:2em>v8虚拟机，无安全机制，所以使用者自行担保安全机制。</p><h2 id=命令行模式><a href=#命令行模式 class=headerlink title=命令行模式></a>命令行模式</h2><p style=text-ident:2em>在命令行模块，Hexo选择使用minimist来解析命令行参数得到一个js对象，并建立一个Hexo实例并初始化，最后通过实例对象call方法传递命令行指令。</p><h2 id=Hexo入口模块设计><a href=#Hexo入口模块设计 class=headerlink title=Hexo入口模块设计></a>Hexo入口模块设计</h2><p style=text-ident:2em>采用构造-原型组合定义类，采用组合继承的方式继承Node的EventEmitter模块，相对简单的完成on与emit的发布订阅。</p><p style=text-ident:2em>实例化阶段，保存所编译文件的存放路径，输出路径，以及其它脚本，插件，主题等所处的路径，保存环境变量，即命令行参数，版本信息号等基本信息。</p><p style=text-ident:2em>创建扩展对象按不同功能进行分类，作用是创建store，用于注册句柄，获取句柄。</p><p style=text-ident:2em>扩展类型控制台(Console)、部署器(Deployer)、过滤器(Filter)、生成器(Generator)、辅助函数(Helper)、处理器(Processor)、渲染引擎(Renderer)</p><figure class="highlight javascript"><table><tr><td class=code><pre><span class=line><span class=keyword>function</span> <span class="title function_">Hexo</span>(<span class=params>base,args</span>)&#123;</span><br><span class=line>    <span class="title class_">EventEmitter</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class=line>    <span class="variable language_">this</span>.<span class=property>public_dir</span>=path.<span class="title function_">join</span>(base,<span class=string>&#x27;public&#x27;</span>);</span><br><span class=line>    <span class="variable language_">this</span>.<span class=property>source_dir</span>=path.<span class="title function_">join</span>(base,<span class=string>&#x27;source&#x27;</span>);</span><br><span class=line>    ...</span><br><span class=line>    <span class="variable language_">this</span>.<span class=property>extend</span>=&#123;</span><br><span class=line>        <span class=attr>console</span>:<span class=keyword>new</span> extend.<span class="title class_">Console</span>();</span><br><span class=line>        <span class=attr>generator</span>:<span class=keyword>new</span> extend.<span class="title class_">Generator</span>();</span><br><span class=line>    	<span class=attr>processor</span>:<span class=keyword>new</span> extend.<span class="title class_">Processor</span>();</span><br><span class=line>    	<span class=attr>renderer</span>:<span class=keyword>new</span> extend.<span class="title class_">Renderer</span>();</span><br><span class=line>    ...</span><br><span class=line>    &#125;</span><br><span class=line>    ...</span><br><span class=line>    <span class=comment>//等同于Object.setPrototypeOf(Hexo.prototype,EventEmitter.prototype);</span></span><br><span class=line>    <span class=built_in>require</span>(<span class=string>&#x27;util&#x27;</span>).<span class="title function_">inherits</span>(<span class="title class_">Hexo</span>,<span class="title class_">EventEmitter</span>);</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p style=text-ident:2em>换句话说，扩展对象是个容器，一个事件注册机。</p><p style=text-ident:2em>接下来要做的是Hexo初始化阶段，加载Hexo内置插件，不断增加扩容工作，以渲染引擎为例，向extend.renderer注册渲染过程处理函数，在其它模块中就可以很方便的从hexo的上下文去调用渲染。</p><figure class="highlight javascript"><table><tr><td class=code><pre><span class=line><span class="title class_">Hexo</span>.<span class=property><span class=keyword>prototype</span></span>.<span class=property>init</span>=<span class=keyword>function</span>(<span class=params></span>)&#123;</span><br><span class=line>    <span class=comment>//加载内部插件</span></span><br><span class=line>    <span class=built_in>require</span>(<span class=string>&#x27;plugins/console&#x27;</span>)(<span class="variable language_">this</span>);</span><br><span class=line>    <span class=built_in>require</span>(<span class=string>&#x27;plugins/generator&#x27;</span>)(<span class="variable language_">this</span>);</span><br><span class=line>    <span class=built_in>require</span>(<span class=string>&#x27;plugins/processor&#x27;</span>)(<span class="variable language_">this</span>);</span><br><span class=line>    <span class=built_in>require</span>(<span class=string>&#x27;plugins/renderer&#x27;</span>)(<span class="variable language_">this</span>);</span><br><span class=line>    ...</span><br><span class=line>&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class=code><pre><span class=line><span class=comment>//plugins/renderer注册渲染函数</span></span><br><span class=line><span class="variable language_">module</span>.<span class=property>exports</span>=<span class=keyword>function</span>(<span class=params></span>)&#123;</span><br><span class=line>    <span class=keyword>var</span> renderer=hexo.<span class=property>extend</span>.<span class=property>renderer</span>;</span><br><span class=line>    renderer.<span class="title function_">register</span>(<span class=string>&#x27;swig&#x27;</span>,<span class=string>&#x27;html&#x27;</span>,<span class=built_in>require</span>(<span class=string>&#x27;./swig&#x27;</span>));</span><br><span class=line> renderer.<span class="title function_">register</span>(<span class=string>&#x27;ejs&#x27;</span>,<span class=string>&#x27;html&#x27;</span>,<span class=built_in>require</span>(<span class=string>&#x27;./ejs&#x27;</span>));</span><br><span class=line> renderer.<span class="title function_">register</span>(<span class=string>&#x27;yml&#x27;</span>,<span class=string>&#x27;josn&#x27;</span>,<span class=built_in>require</span>(<span class=string>&#x27;./yaml&#x27;</span>));</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class=code><pre><span class=line><span class=comment>//调用渲染器 </span></span><br><span class=line><span class="variable language_">module</span>.<span class=property>exprots</span>=<span class=keyword>function</span>(<span class=params>hexo</span>)&#123;</span><br><span class=line>     <span class=keyword>var</span> renderer=hexo.<span class=property>extend</span>.<span class=property>renderer</span>;</span><br><span class=line>     <span class=keyword>return</span> renderer.<span class="title function_">get</span>(<span class=string>&#x27;ejs&#x27;</span>);</span><br><span class=line> &#125;</span><br></pre></td></tr></table></figure><p style=text-ident:2em>hexo 还能加载外部插件,通过 npm 的方式存放在 node_module 或目录 script 里面，巧妙的是，插件内部无效引入 hexo 对象，可以直接hexo变量来访问上下文，正是由于框架采用 Node 中 vm 模块(Virtual Machine) 模块来加载 js 文件，相当于模板引擎实现原理中的new Function或者 eval 来解析并执行字符串代码。</p><figure class="highlight javascript"><table><tr><td class=code><pre><span class=line><span class=comment>//加载外部插件</span></span><br><span class=line><span class="title class_">Hexo</span>.<span class=property><span class=keyword>prototype</span></span>.<span class=property>loadPlugin</span>=<span class=keyword>function</span>(<span class=params>path</span>)&#123;</span><br><span class=line>    fs.<span class="title function_">readFile</span>(path).<span class="title function_">then</span>(<span class=keyword>function</span>(<span class=params>script</span>)&#123;</span><br><span class=line>       script=<span class=string>`(function(hexo)&#123;`</span>+script+<span class=string>&#x27;&#125;)&#x27;</span>; </span><br><span class=line>    &#125;);</span><br><span class=line>    retutn vm.<span class="title function_">runInThisContext</span>(script,path)(<span class="variable language_">this</span>)</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><h2 id=Hexo编译模块设计><a href=#Hexo编译模块设计 class=headerlink title=Hexo编译模块设计></a>Hexo编译模块设计</h2><p style=text-ident:2em>预期用户命令接口</p><figure class="highlight bash"><table><tr><td class=code><pre><span class=line>$ hexo generate</span><br></pre></td></tr></table></figure><p style=text-ident:2em>首先往 Hexo 扩展对象 Console 中注册 &#x3D;&#x3D;generate&#x3D;&#x3D; 函数</p><figure class="highlight javascript"><table><tr><td class=code><pre><span class=line><span class="variable language_">console</span>.<span class="title function_">register</span>(<span class=string>&#x27;generate&#x27;</span>,<span class=string>&#x27;Generate static files&#x27;</span>,&#123;</span><br><span class=line>   <span class=attr>options</span>:[</span><br><span class=line>       &#123;<span class=attr>name</span>:<span class=string>&#x27;-d,--deloy&#x27;</span>,<span class=attr>desc</span>:<span class=string>&#x27;Deploy after generated&#x27;</span>&#125;,</span><br><span class=line>       &#123;<span class=attr>name</span>:<span class=string>&#x27;-f,--force&#x27;</span>,<span class=attr>desc</span>:<span class=string>&#x27;Force regenerate&#x27;</span>&#125;,</span><br><span class=line>       &#123;<span class=attr>name</span>:<span class=string>&#x27;-w,--watch&#x27;</span>,<span class=attr>dec</span>:<span class=string>&#x27;Watch file changes&#x27;</span>&#125;,</span><br><span class=line>   ]</span><br><span class=line>&#125;,<span class=built_in>require</span>(<span class=string>&#x27;/generate&#x27;</span>))</span><br></pre></td></tr></table></figure><p style=text-ident:2em>generate 函数用于生成目标文件夹，从 Hexo 路由模块中取得所由需要生成目标文件的路径，调用fs输出文件，在此之前，首先对源文件进行预处理，把路径写入路由。由于Hexo本身设计的特点，源文件又分为内容和主题两部分，分别为放在 source 和theme文件夹中，所以得调用 process 函数分别对它们进行预处理。</p><figure class="highlight javascript"><table><tr><td class=code><pre><span class=line><span class=keyword>function</span> <span class="title function_">generate</span>(<span class=params>hexo</span>)&#123;</span><br><span class=line>    hexo.<span class=property>source</span>.<span class="title function_">process</span>();</span><br><span class=line>    hexo.<span class=property>theme</span>.<span class="title function_">process</span>();</span><br><span class=line>    routerList.<span class="title function_">forEach</span>(<span class=function><span class=params>path</span>=&gt;</span><span class="title function_">writeFile</span>(path));</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p style=text-ident:2em>Hexo 抽象出一层公用模块用来管理所有处理器，命名为Box，相当于一个容器，统一管理处理器的添加删除执行监控，并分别为source和theme创建实列，Box原型如下：</p><figure class="highlight javascript"><table><tr><td class=code><pre><span class=line><span class=keyword>function</span> <span class="title function_">Box</span>(<span class=params>base</span>)&#123;</span><br><span class=line>    <span class="variable language_">this</span>.<span class=property>base</span>=base;</span><br><span class=line>    <span class="variable language_">this</span>.<span class=property>processors</span>=[];</span><br><span class=line>&#125;</span><br><span class=line><span class="title class_">Box</span>.<span class=property><span class=keyword>prototype</span></span>.<span class=property>addProcessor</span>=<span class=keyword>function</span>(<span class=params>pattern,fn</span>)&#123;</span><br><span class=line>    <span class="variable language_">this</span>.<span class=property>processors</span>.<span class="title function_">push</span>(&#123;</span><br><span class=line>        pattern,</span><br><span class=line>        <span class=attr>process</span>:fn,</span><br><span class=line>    &#125;);</span><br><span class=line>&#125;;</span><br><span class=line><span class="title class_">Box</span>.<span class=property><span class=keyword>prototype</span></span>.<span class=property>process</span>=<span class=keyword>function</span>(<span class=params>callback</span>)&#123;</span><br><span class=line>    <span class="variable language_">this</span>.<span class=property>processors</span>.<span class="title function_">forEach</span>(<span class=function><span class=params>processor</span>=&gt;</span>processor.<span class="title function_">process</span>());</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p style=text-ident:2em>有了Box容器，接下来要做的就是往容器注入处理器，同样用插件形式往扩展对象extend中注册句柄，在注入到 Box 容器</p><figure class="highlight javascript"><table><tr><td class=code><pre><span class=line><span class="variable language_">module</span>.<span class=property>exports</span>=<span class=keyword>function</span>(<span class=params>hexo</span>)&#123;</span><br><span class=line>    <span class=keyword>var</span> &#123;processor&#125;=hexo.<span class=property>extend</span>;</span><br><span class=line>    <span class=keyword>var</span> obj=<span class=built_in>require</span>(<span class=string>&#x27;./asset&#x27;</span>)(hexo);</span><br><span class=line>    processer.<span class="title function_">register</span>(obj.<span class=property>pattern</span>,obj.<span class=property>process</span>);</span><br><span class=line>    ...</span><br><span class=line>&#125;;</span><br></pre></td></tr></table></figure><p style=text-ident:2em>以markdown文件的处理为例，成功匹配到文件扩展名，调用hexo-font-matter利用正则表达式匹配解析文件，分离顶部元素据与主题内容，类似于gray-matter，把元数据与内容key&#x2F;value的形式转换为一个js对象。</p><figure class="highlight javascript"><table><tr><td class=code><pre><span class=line><span class="variable language_">module</span>.<span class=property>exports</span>=<span class=keyword>function</span>(<span class=params>hexo</span>)&#123;</span><br><span class=line>    <span class=keyword>return</span> &#123;</span><br><span class=line>        <span class=attr>patter</span>:<span class=regexp>/\.md/</span>,</span><br><span class=line>        <span class=attr>process</span>:<span class=keyword>function</span>(<span class=params>path</span>)&#123;</span><br><span class=line>            <span class="title function_">readFile</span>(path,<span class=keyword>function</span>(<span class=params>err,content</span>)&#123;</span><br><span class=line>               <span class=keyword>var</span> data=<span class=built_in>require</span>(<span class=string>&#x27;hexo-front-matter&#x27;</span>)(content);</span><br><span class=line>                data.<span class=property>source</span>=path;</span><br><span class=line>                data.<span class=property>raw</span>=content;</span><br><span class=line>                <span class=keyword>return</span> data;</span><br><span class=line>            &#125;);</span><br><span class=line>        &#125;</span><br><span class=line>    &#125;</span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class=code><pre><span class=line><span class=string>//markdown文件</span></span><br><span class=line><span class=meta>---</span></span><br><span class=line><span class=string>title:hello,</span></span><br><span class=line><span class=string>layout:home</span></span><br><span class=line><span class=meta>---</span></span><br><span class=line><span class=comment>#hexo</span></span><br><span class=line><span class=string>A</span> <span class=string>fast,simple&amp;porwerful</span> <span class=string>blog</span> <span class=string>framework</span></span><br></pre></td></tr></table></figure><p style=text-ident:2em>解析成&#x3D;&gt;</p><figure class="highlight javascript"><table><tr><td class=code><pre><span class=line>&#123;</span><br><span class=line>    <span class=attr>title</span>:<span class=string>&#x27;hello&#x27;</span>,</span><br><span class=line>    <span class=attr>layout</span>:<span class=string>&#x27;home&#x27;</span>,</span><br><span class=line>    <span class=attr>_content</span>:<span class=string>&#x27;# Hexo\n fast,simple&amp;porwerful blog framework&#x27;</span>,</span><br><span class=line>    <span class=attr>source</span>:<span class=string>&#x27;README.md&#x27;</span>,</span><br><span class=line>    <span class=attr>raw</span>:<span class=string>`---\ntitile:hello\n---# Hexo\n fast,simple&amp;porwerful blog framework`</span></span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p style=text-ident:2em>下一步，Hexo定义过滤器的概念(Filter)的概念，借鉴于Wordpress，用于在模板渲染前后修改具体数据，也可以把它看成钩子，例如使用 marked 编译 markdown 文件内容。</p><figure class="highlight javascript"><table><tr><td class=code><pre><span class=line>hexo.<span class="title function_">execFilter</span>(<span class=params><span class=string>&#x27;before_generate&#x27;</span>,<span class=keyword>function</span>(data)</span>)&#123;</span><br><span class=line>     hexo.<span class=property>render</span>.<span class="title function_">render</span>(&#123;</span><br><span class=line>        <span class=attr>text</span>:data.<span class=property>_content</span>,</span><br><span class=line>        <span class=attr>path</span>:data.<span class=property>source</span>,</span><br><span class=line>        <span class=attr>engine</span>:data.<span class=property>engine</span></span><br><span class=line>        &#125;);</span><br><span class=line>&#125;;</span><br></pre></td></tr></table></figure><p style=text-ident:2em>转换后增加一条 content 属性，带有标签与类名的markdown html 片段。</p><figure class="highlight javascript"><table><tr><td class=code><pre><span class=line>&#123;</span><br><span class=line>    <span class=attr>title</span>:<span class=string>&#x27;hello&#x27;</span>,</span><br><span class=line>    <span class=attr>layout</span>:<span class=string>&#x27;home&#x27;</span>,</span><br><span class=line>    <span class=attr>_content</span>:<span class=string>&#x27;# Hexo\n fast,simple&amp;porwerful blog framework&#x27;</span>,</span><br><span class=line>    <span class=attr>content</span>:<span class=string>&#x27;&lt;h1 id=&quot;Hexo&quot;&gt;&lt;a href=&quot;#Hexo&quot; class=&quot;headerlink&quot; title=&quot;Hexo&quot;&gt;Hexo&lt;/a&gt;&lt;/h1&gt;&lt;p&gt;fast,simple&amp;porwerful blog framework&lt;/p&gt;&#x27;</span></span><br><span class=line>    <span class=attr>source</span>:<span class=string>&#x27;README.md&#x27;</span>,</span><br><span class=line>    <span class=attr>raw</span>:<span class=string>`---\ntitile:hello\n---# Hexo\n fast,simple&amp;porwerful blog framework`</span></span><br><span class=line>&#125;</span><br></pre></td></tr></table></figure><p style=text-ident:2em>得到页面数据后，进入模板引擎渲染阶段，Hexo 本身并不带模板引擎，需要借助第三方库，如ejs，并通过一个适配器，把原接口转换为需求接口，向扩展对象extend.render中注册模板解析函数。</p><figure class="highlight javascript"><table><tr><td class=code><pre><span class=line>hexok.<span class=property>extend</span>.<span class=property>renderer</span>.<span class="title function_">register</span>(<span class=string>&#x27;ejs&#x27;</span>,<span class=string>&#x27;html&#x27;</span>,<span class=keyword>function</span>(<span class=params>data,locals</span>)&#123;</span><br><span class=line>   <span class=built_in>require</span>(<span class=string>&#x27;ejs&#x27;</span>).<span class="title function_">render</span>(data,locals) </span><br><span class=line>&#125;);</span><br></pre></td></tr></table></figure><p style=text-ident:2em>模板引擎解析后的函数在hexo.theme对象中， 以文件名作为key，后续渲染只需要layout就能找到指定的渲染函数，注入locals变量(上面markdown解析后的js对象+扩展对象extend.helper定义变量，函数)，生成最终文本字符串。</p><figure class="highlight javascript"><table><tr><td class=code><pre><span class=line><span class=keyword>var</span> view=hexo.<span class=property>theme</span>.<span class="title function_">getView</span>(data.<span class=property>layout</span>);</span><br><span class=line>view.<span class="title function_">render</span>(lcoals);</span><br></pre></td></tr></table></figure><p style=text-ident:2em>最后通过Node fs 模块将内容输出public目标。</p><p style=text-ident:2em>回顾所有的工作流程，可以看作是</p><p style=text-ident:2em>cli&#x3D;&gt;hexo.init&#x3D;&gt;plugin.load&#x3D;&gt;process&#x3D;&gt;filter&#x3D;&gt;render&#x3D;&gt;generate</p><h2 id=扩展阅读><a href=#扩展阅读 class=headerlink title=扩展阅读></a>扩展阅读</h2><p style=text-ident:2em>此外，Hexo还有很多优秀的设计模式</p><h3 id=数据库系统><a href=#数据库系统 class=headerlink title=数据库系统></a>数据库系统</h3><p style=text-ident:2em>Hexo 引入 json 数据库 warehouse ,也是作者自己开发的一个数据库驱动，api 和 Mongoose 相差无几。在架构中角色充当一个中介者，存储临时数据，或者持久化数据数据存储，如博客的发表时间，还可以作为缓存层，比对文件修改时间，跳过无修改文件的编译过程，减少二次编译的时间。</p><h3 id=异步方案><a href=#异步方案 class=headerlink title=异步方案></a>异步方案</h3><p style=text-ident:2em>在大量异步回调文件会造成代码阅读性下降。</p><p style=text-ident:2em>Hexo 引入 Promise 库 bindBrid, 内置丰富 API，</p><p style=text-ident:2em>很方便的处理异步的流程控制，如使用 Promise.promisify(require(‘fs’).readFile)可以原生 fs 模块包装成一个promise对象。</p><h3 id=通用日志模块><a href=#通用日志模块 class=headerlink title=通用日志模块></a>通用日志模块</h3><p style=text-ident:2em>把Log划分为六个级别，’TRACE’,’DEBUG’,’INFO,’WARN’,’FATAL’,不同级别输出不同的格式与颜色(chalk) ,并提供命令含接口，如果带有–debug字段，则Log自动降级为’TRACE’。</p><hr><h2 id=Hexo><a href=#Hexo class=headerlink title=Hexo></a>Hexo</h2><h3 id=变量><a href=#变量 class=headerlink title=变量></a>变量</h3><p style=text-ident:2em>_config.yml</p><p style=text-ident:2em>markdown.md Front-matter</p><h3 id=多语言支持><a href=#多语言支持 class=headerlink title=多语言支持></a>多语言支持</h3><h3 id=主题><a href=#主题 class=headerlink title=主题></a>主题</h3><h4 id=全局设置><a href=#全局设置 class=headerlink title=全局设置></a>全局设置</h4><h4 id=语言><a href=#语言 class=headerlink title=语言></a>语言</h4><h4 id=模板><a href=#模板 class=headerlink title=模板></a>模板</h4><p style=text-ident:2em>基本就是网站布局，如果你想要亲手制作一个Hexo的主题，那么就要深入了解这块内容。每一个主题至少都要包含index模板，下面是各页面对应的模板名称：</p><ul><li>index 首页</li><li>post 文章</li><li>page 分页</li><li>archive 归档</li><li>category 分类归档</li><li>tag 标签归档</li></ul><h5 id=Layouts-布局><a href=#Layouts-布局 class=headerlink title="Layouts 布局"></a>Layouts 布局</h5><p style=text-ident:2em>如果页面结构类似，模板之间都包含相同结构，可以使用布局功能让模板共享相同结构。一个布局文件必须要能包含显示body变量内容，如此一来模板内容才能显示。</p><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>&lt;!-- index.ejs --&gt;</span><br><span class=line>index</span><br><span class=line>&lt;!-- layout.ejs --&gt;</span><br><span class=line>&lt;html&gt;</span><br><span class=line>    &lt;body&gt;</span><br><span class=line>        &lt;%- body %&gt;</span><br><span class=line>    &lt;/body&gt;</span><br><span class=line>&lt;/html&gt;</span><br></pre></td></tr></table></figure><p style=text-ident:2em>生成结果：</p><figure class="highlight html"><table><tr><td class=code><pre><span class=line><span class=meta>&lt;!DOCTYPE <span class=keyword>html</span>&gt;</span></span><br><span class=line><span class=tag>&lt;<span class=name>html</span>&gt;</span></span><br><span class=line>    <span class=tag>&lt;<span class=name>body</span>&gt;</span></span><br><span class=line>        index</span><br><span class=line>    <span class=tag>&lt;/<span class=name>body</span>&gt;</span></span><br><span class=line><span class=tag>&lt;/<span class=name>html</span>&gt;</span></span><br></pre></td></tr></table></figure><p style=text-ident:2em>每个模板都默认使用 <strong>layout</strong> 布局，你可在文章的前置申明指定布局。比如 post 或者 page 或者设为 false 来关闭布局功能。如果不填默认是 post ，这个在_config.yml中设置默认值，你甚至可以在布局中中再使用其它布局来建立嵌套布局。</p><h5 id=Pratials-局部模板><a href=#Pratials-局部模板 class=headerlink title="Pratials 局部模板"></a>Pratials 局部模板</h5><p style=text-ident:2em>局部模板可以让你在不同的模板中分享相同的组件，例如Header，Footer，Sidebar侧边栏等，可以利用局部模版功能将各个组件分割独立的文件，便于维护。</p><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>&lt;!-- partial/header.ejs--&gt;</span><br><span class=line>&lt;h1 id=&quot;logo&quot;&gt;</span><br><span class=line>    &lt;%= config.title %&gt;</span><br><span class=line>&lt;/h1&gt;</span><br><span class=line>&lt;!-- index.ejs--&gt;</span><br><span class=line>&lt;div id=&quot;content&quot;&gt;</span><br><span class=line>    Home page</span><br><span class=line>&lt;/div&gt;</span><br></pre></td></tr></table></figure><p style=text-ident:2em>生成就是：</p><figure class="highlight html"><table><tr><td class=code><pre><span class=line><span class=tag>&lt;<span class=name>h1</span> <span class=attr>id</span>=<span class=string>&quot;logo&quot;</span>&gt;</span></span><br><span class=line>    My Site</span><br><span class=line><span class=tag>&lt;/<span class=name>h1</span>&gt;</span></span><br><span class=line><span class=tag>&lt;<span class=name>div</span> <span class=attr>id</span>=<span class=string>&quot;content&quot;</span>&gt;</span></span><br><span class=line>    Home page</span><br><span class=line><span class=tag>&lt;/<span class=name>div</span>&gt;</span></span><br></pre></td></tr></table></figure><p style=text-ident:2em>这个很容易理解，就是将局部模块里的内容，原封不动的拷贝到引用它的文件中。</p><h5 id=Local-Variables-本地变量><a href=#Local-Variables-本地变量 class=headerlink title="Local Variables 本地变量"></a>Local Variables 本地变量</h5><p style=text-ident:2em>这里的变量指的是针对局部模板来使用的，你可以在局部模块中指定局部变量来进行传递。例如：</p><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>&lt;!--partial/header.ejs--&gt;</span><br><span class=line>&lt;h1 id=&quot;logo&quot;&gt;</span><br><span class=line>    &lt;%- title %&gt;</span><br><span class=line>&lt;/h1&gt;</span><br><span class=line>&lt;!--index.ejs--&gt;</span><br><span class=line>&lt;%- partial(&#x27;partial/header&#x27;,&#123;title:&#x27;Hello,World&#x27;&#125;) %&gt;</span><br><span class=line>&lt;div id=&quot;content&quot;&gt;</span><br><span class=line>    Home page</span><br><span class=line>&lt;/div&gt;</span><br></pre></td></tr></table></figure><p style=text-ident:2em>生成后就是：</p><figure class="highlight html"><table><tr><td class=code><pre><span class=line><span class=tag>&lt;<span class=name>h1</span> <span class=attr>id</span>=<span class=string>&quot;logo&quot;</span>&gt;</span></span><br><span class=line>    Hello World</span><br><span class=line><span class=tag>&lt;/<span class=name>h1</span>&gt;</span></span><br><span class=line><span class=tag>&lt;<span class=name>div</span> <span class=attr>id</span>=<span class=string>&quot;content&quot;</span>&gt;</span></span><br><span class=line>    Home page</span><br><span class=line><span class=tag>&lt;/<span class=name>div</span>&gt;</span></span><br></pre></td></tr></table></figure><p style=text-ident:2em>这个也不难理解，就是传递变量的过程。</p><h5 id=Optimization-最优化><a href=#Optimization-最优化 class=headerlink title="Optimization 最优化"></a>Optimization 最优化</h5><p style=text-ident:2em>假如你的主题特别复杂，因为要生成的文件过于庞大，这样导致hexo 生成性能下降，除了优化主题外，你可以通过 Fragment Caching 局部缓存的功能来处理。它主要的功能是缓存局部的内容，减少文件查询。</p><p style=text-ident:2em>常用在哪些变动很少的模块。例如Header、Footer。</p><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>&lt;%- fragment_cache(&#x27;header&#x27;,function()&#123;</span><br><span class=line>   retutn `&lt;header&gt;&lt;/header&gt;` </span><br><span class=line>&#125;);</span><br></pre></td></tr></table></figure><p style=text-ident:2em>如果使用局部模板的话，如下：</p><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>&lt;%- partial(&#x27;header&#x27;,&#123;&#125;,&#123;cache:true&#125;);</span><br></pre></td></tr></table></figure><p style=text-ident:2em>但是需要注意的是，如果开启了<code>relativet1_link</code>参数的话，就不要使用局部缓存的功能，因为relative link在每个页面可能不同。</p><h4 id=变量-1><a href=#变量-1 class=headerlink title=变量></a>变量</h4><h5 id=全局变量><a href=#全局变量 class=headerlink title=全局变量></a>全局变量</h5><ul><li><code>site</code>网站变量</li><li><code>site.posts</code> 所有文章</li><li><code>site.pages</code>所有分类</li><li><code>site.categories</code>所有分类</li><li><code>site.tags</code>所有标签</li><li><code>page</code>针对改页面的内容以及申明前置所设定的变量</li><li><code>config</code>配置文件中的变量</li><li><code>theme</code>配置文件中的变量</li><li><code>_</code>lodash函数库</li><li><code>path</code>当前页面的路径(不含根路径)</li><li><code>url</code>页面完整</li><li><code>env</code>环境变量</li></ul><h5 id=页面变量><a href=#页面变量 class=headerlink title=页面变量></a>页面变量</h5><p style=text-ident:2em><strong>Page</strong> 这里指的是 <code>hexo new page</code>创建的页面</p><ul><li><code>page.title</code>文章标题</li><li><code>page.date</code>文章建立日期</li><li><code>page.updated</code>文章更新日期</li><li><code>page.comments</code>留言是否开启</li><li><code>page.layout</code>布局名称</li><li><code>page.content</code>文章完整内容</li><li><code>page.excerpt</code>文章摘要</li><li><code>page.more</code>除了摘要的其它内容</li><li><code>page.source</code>文章原始路径</li><li><code>page.full_source</code>文章完整原始路径</li><li><code>page.path</code>文章网址(不含根路径)，通常在主题中使用 <code>url_for(page.path)</code></li><li><code>page.permalink</code>文章永久网址</li><li><code>page.prev</code>上一章，如果此为第一篇文章则为 <code>null</code></li><li><code>page.next</code>下一章，如果此为最后一篇文章则为 <code>null</code></li><li><code>page.raw</code>文章的原始内容</li><li><code>page.photos</code>文章的照片(用于相册)</li><li><code>page.link</code>文章的外链(用于链接文章)</li></ul><p style=text-ident:2em><strong>Post</strong>这里指的是文章页面，与page布局相同，添加如下变量：</p><ul><li><code>page.pulished</code>文章非草稿为 <code>true</code></li><li><code>page.categories</code>文章分类</li><li><code>page.tags</code>文章的标签</li></ul><p style=text-ident:2em><strong>首页 index</strong></p><ul><li><code>page.per_page</code>每一页显示的文章数</li><li><code>page.total</code>文章数量</li><li><code>page.current</code> 当前页码</li><li><code>page.current_url</code>当前页的URL</li><li><code>page.posts</code>当前页的文章ge</li><li><code>page.prev</code>前一页页码，如果为第一页，该值为0</li><li><code>page.prev_link</code>前一页URL，如果为第一页，则为“</li><li><code>page.next_link</code>后一页URL，如果为最后一页，则为”</li><li><code>page.path</code>当前不含根路径网址，通常在主题中使用 <code>url_for(page.path)</code></li></ul><p style=text-ident:2em><strong>归档页 archive</strong></p><p style=text-ident:2em>与<code>index</code>布局相同，但是新增如下变量</p><ul><li><code>archive</code>为 <code>true</code></li><li><code>year</code>归档年份</li><li><code>month</code>归档月份</li></ul><p style=text-ident:2em><strong>分类页 category</strong></p><p style=text-ident:2em>与 <code>index</code> 布局相同，但是新增如下变量</p><ul><li><code>category</code>分类名称</li></ul><p style=text-ident:2em><strong>标签页</strong></p><p style=text-ident:2em>与 <code>index</code> 布局相同，但是新增如下变量</p><ul><li><code>tag</code>标签名称</li></ul><h4 id=帮助函数><a href=#帮助函数 class=headerlink title=帮助函数></a>帮助函数</h4><p style=text-ident:2em>帮助函数用于在模板中快速插入内容</p><h5 id=url><a href=#url class=headerlink title=url></a>url</h5><ol><li><p style=text-ident:2em><code>url_for</code>返回一个带root路径的，用法 <code>&lt;%- url_for(path) %&gt;</code></p></li><li><p style=text-ident:2em><code>relative_url</code>返回from相对的to路径，用法 <code>&lt;%- relative_url %&gt;</code></p></li><li><p style=text-ident:2em><code>gravater</code>插入Gravatar图片，用法：<code>&lt;%- gravagtar(email,[size]) %&gt;</code></p><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>&lt;%- gravatar(&#x27;a@abc.com&#x27;) %&gt;</span><br><span class=line> // http://www.gravatar.com/avatar/b9b00e66c6b8a70f88c73cb6bdb06787</span><br><span class=line>&lt;%- gravatar(&#x27;a@abc.com&#x27;,40) %&gt;</span><br><span class=line> // http://www.gravatar.com/avatar/b9b00e66c6b8a70f88c73cb6bdb06787?s=40</span><br></pre></td></tr></table></figure></li></ol><h5 id=HTML><a href=#HTML class=headerlink title=HTML></a>HTML</h5><ol><li><p style=text-ident:2em><code>css</code>载入CSS文件。用法：<code>&lt;% css(path,...) %&gt;</code>,<code>path</code>可以是数据或者字符串，如果 <code>path</code>开头不是 <code>/</code> 或者任何协议，则会自动加上根路径，如果没有 <code>.css</code>扩展名，也会自动加上。</p><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>&lt;%- css(&#x27;style.css&#x27;) %&gt;</span><br><span class=line>// &lt;link rel=&quot;stylesheet&quot; href=&quot;/style.css&quot; type=&quot;text/css&quot;&gt;</span><br><span class=line>   </span><br><span class=line>&lt;%- css([&#x27;style.css&#x27;, &#x27;screen.css&#x27;]) %&gt;</span><br><span class=line>// &lt;link rel=&quot;stylesheet&quot; href=&quot;/style.css&quot; type=&quot;text/css&quot;&gt;</span><br><span class=line>// &lt;link rel=&quot;stylesheet&quot; href=&quot;/screen.css&quot; type=&quot;text/css&quot;&gt;</span><br></pre></td></tr></table></figure></li><li><p style=text-ident:2em><code>js</code> 载入 JavaScript 文件。用法：<code>&lt;%- js(path, ...) %&gt;</code>，<code>path</code> 可以是数组或字符串，如果 <code>path</code> 开头不是 <code>/</code>或任何协议，则会自动加上根路径；如果后面没有加上 <code>.js</code>扩展名的话，也会自动加上。</p><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>&lt;%- js(&#x27;script.js&#x27;) %&gt;</span><br><span class=line>// &lt;script type=&quot;text/javascript&quot; src=&quot;/script.js&quot;&gt;&lt;/script&gt;</span><br><span class=line>&lt;%- js([&#x27;script.js&#x27;, &#x27;gallery.js&#x27;]) %&gt;</span><br><span class=line>// &lt;script type=&quot;text/javascript&quot; src=&quot;/script.js&quot;&gt;&lt;/script&gt;</span><br><span class=line>// &lt;script type=&quot;text/javascript&quot; src=&quot;/gallery.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure></li><li><p style=text-ident:2em><code>link_to</code> 插入链接。用法：<code>&lt;%- link_to(path, [text], [options]) %&gt;</code>，<code>options</code>参数有：</p><ul><li><p style=text-ident:2em><code>external</code> 在新窗口中打开链接，默认值为false</p></li><li><p style=text-ident:2em><code>class</code> Class名称，也就是html标签a的class名</p></li><li><p style=text-ident:2em><code>id</code> ID名，也就是html标签a的id名</p></li></ul></li></ol><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>&lt;%- link_to(&#x27;http://www.google.com&#x27;) %&gt;</span><br><span class=line>// &lt;a href=&quot;http://www.google.com&quot; title=&quot;http://www.google.com&quot;&gt;http://www.google.com&lt;/a&gt;</span><br><span class=line></span><br><span class=line>&lt;%- link_to(&#x27;http://www.google.com&#x27;, &#x27;Google&#x27;) %&gt;</span><br><span class=line>// &lt;a href=&quot;http://www.google.com&quot; title=&quot;Google&quot;&gt;Google&lt;/a&gt;</span><br><span class=line></span><br><span class=line>&lt;%- link_to(&#x27;http://www.google.com&#x27;, &#x27;Google&#x27;, &#123;external: true, class: &quot;link&quot;&#125;) %&gt;</span><br><span class=line>// &lt;a href=&quot;http://www.google.com&quot; title=&quot;Google&quot; target=&quot;_blank&quot; rel=&quot;external&quot; class=&quot;link&quot;&gt;Google&lt;/a&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>// &lt;a href=&quot;http://www.google.com&quot; title=&quot;Google&quot; target=&quot;_blank&quot; rel=&quot;external&quot; class=&quot;link&quot;&gt;Google&lt;/a&gt;</span><br></pre></td></tr></table></figure><ol start=4><li><code>mail_to</code> 插入电子邮件链接。用法：<code>&lt;%- mail_to(path, [text], [options])%&gt;</code>，<code>options</code>参数有：</li></ol><ul><li><code>class</code> Class名称，也就是html标签a的class名</li><li><code>id</code> ID名，也就是html标签a的id名</li><li><code>subject</code> 邮件主题</li><li><code>cc</code> 抄送（CC）</li><li><code>bcc</code> 密送（BCC）</li><li><code>body</code> 邮件内容</li></ul><figure class="highlight plaintext"><table><tr><td class=code><pre><span class=line>&lt;%- mail_to(&#x27;a@abc.com&#x27;) %&gt;</span><br><span class=line>// &lt;a href=&quot;mailto:a@abc.com&quot; title=&quot;a@abc.com&quot;&gt;a@abc.com&lt;/a&gt;</span><br><span class=line></span><br><span class=line>&lt;%- mail_to(&#x27;a@abc.com&#x27;, &#x27;Email&#x27;) %&gt;</span><br><span class=line>// &lt;a href=&quot;mailto:a@abc.com&quot; title=&quot;Email&quot;&gt;Email&lt;/a&gt;  </span><br></pre></td></tr></table></figure><p style=text-ident:2em>5.<code>image_tag</code> 插入图片。用法：<code>&lt;%- image_tag(path, [options]) %&gt;</code>，<code>options</code>参数有：</p><ul><li><code>class</code> Class名称，也就是html标签a的class名</li><li><code>id</code> ID名，也就是html标签a的id名</li><li><code>alt</code> 替代文字</li><li><code>width</code> 宽度</li><li><code>height</code> 高度</li></ul><p style=text-ident:2em>基本上就是<code>img</code>标签里的属性值。</p><p style=text-ident:2em>6.<code>favicon_tag</code>插入favicon。用法：<code>&lt;%- favicon_tag(path) %&gt;</code></p><p style=text-ident:2em>7.<code>feed_tag</code> 插入feed链接。用法：<code>&lt;%- feed_tag(path, [options]) %&gt;</code>，参数有：<code>title</code>和<code>type</code>(默认值为atom)</p><h5 id=条件函数><a href=#条件函数 class=headerlink title=条件函数></a>条件函数</h5><ul><li><code>is_current</code> 判断<code>path</code>是否符合目前页面的网址。<code>&lt;%- is_current(path, [strict]) %&gt;</code></li><li><code>is_home</code> 判断目前是否为首页。</li><li><code>is_post</code> 检查目前是否为文章。 <code>&lt;%- is_post() %&gt;</code></li><li><code>is_archive</code> 检查目前是否为存档页面。<code>&lt;%- is_archive() %&gt;</code></li><li><code>is_year</code> 检查目前是否为年度归档页面。<code>&lt;%- is_year() %&gt;</code></li><li><code>is_month</code>检查目前是否为月度归档页面。&lt;%- is_month() %&gt;</li><li><code>is_category</code>检查目前是否为分类归档页面。&lt;%- is_category() %&gt;</li><li><code>is_tag</code>检查目前是否为标签归档页面。<code>&lt;%- is_tag() %&gt;</code></li></ul><h5 id=字符串处理><a href=#字符串处理 class=headerlink title=字符串处理></a>字符串处理</h5><ul><li><code>trim</code>清楚字符串开头和结尾的空格。<code>&lt;%- trim(string) %&gt;</code></li><li><code>strip_html</code>清楚字符串中HTML标签。<code>&lt;%- strip_html(string) %&gt;</code></li><li><code>titlecase</code>把字符串转换为Title case。<code>&lt;%- titlecase(string) %&gt;</code></li><li><code>markdown</code>使用 Markdown 解析字符串。<code>&lt;%- markdown(string) %&gt;</code></li><li><code>render</code> 解析字符串。<code>&lt;%- render(str, engine, [options]) %&gt;</code></li><li><code>word_wrap</code>使每行的字符串长度不超过 <code>length</code>。<code>length</code> 预设为 80。<code>&lt;%- word_wrap(str, [length]) %&gt;</code></li><li><code>truncate</code>移除超过 <code>length</code> 长度的字符串。<code>&lt;%- truncate(text, length) %&gt;</code></li></ul><h5 id=模板-1><a href=#模板-1 class=headerlink title=模板></a>模板</h5><ul><li><code>partial</code>载入其它模板文件，你可在 <code>locals</code>设定变量。<code>&lt;%- partial(layout,[locals],[options]) %&gt;</code></li></ul><table><thead><tr><th>参数</th><th>描述</th><th>默认值</th></tr></thead><tbody><tr><td>cache</td><td>缓存，使用Fragment cache</td><td><code>false</code></td></tr><tr><td>only</td><td>限制局部变量，在模板中只能使用 <code>locals</code>中设定的变量</td><td><code>false</code></td></tr></tbody></table><ul><li><code>fragment_cache</code>局部缓存。它储存局部内容，下次使用时就能直接使用缓存。<code>&lt;%- fragment_cache(id, fn);</code></li></ul><h5 id=日期和时间><a href=#日期和时间 class=headerlink title=日期和时间></a>日期和时间</h5><p style=text-ident:2em><code>date</code>插入的格式化的日期，Unix，ISO字符串，Date对象或Moment对象。</p><p style=text-ident:2em><code>format</code>默认为 <code>date_format</code>配置信息。</p><p style=text-ident:2em><code>&lt;%- date(Date.now(),&#39;YYYY/M/D) %&gt;</code></p><p style=text-ident:2em><code>date_xml</code>插入XML格式的日期。数据格式和调用同上。</p><p style=text-ident:2em><code>time</code>&#x2F;<code>full_date</code></p><h5 id=列表><a href=#列表 class=headerlink title=列表></a>列表</h5><ul><li><code>list_categories</code>插入分类列表，<code>&lt;%- list_categories([categories], [options]) %&gt;</code></li><li><code>list_tags</code></li><li><code>list_archives</code></li><li><code>lsit_posts</code></li><li><code>tagclound</code><strong>想要学习</strong></li><li><code>paginator</code>插入分页连接</li><li><code>search_form</code>插入谷歌搜索</li><li><code>number_format</code></li><li><code>open_graph</code></li><li><code>toc</code></li></ul><h2 id=事件><a href=#事件 class=headerlink title=事件></a>事件</h2><p style=text-ident:2em>hexo 的生命周期</p><h4 id=本地化><a href=#本地化 class=headerlink title=本地化></a>本地化</h4><h4 id=插件><a href=#插件 class=headerlink title=插件></a>插件</h4><h4 id=注意><a href=#注意 class=headerlink title=注意></a>注意</h4><p style=text-ident:2em>上面提到的所有<code>Options</code>参数一定要按照<code>json</code>的格式来书写；</p><div style=text-align:center;color:#ccc;font-size:14px;margin:2em>---------------- The End and <span style=color:brown;font-weight:700>I</span> hope <span style=color:#f4d772;font-weight:700;font-size:1.5em>sunshines</span> on the outside. ----------------</div><div id=days style=text-align:center class=hover-text></div><script>function show_date_time(){window.setTimeout("show_date_time()",1e3),BirthDay=new Date("06/03/2022 12:45:49"),today=new Date,timeold=today.getTime()-BirthDay.getTime(),sectimeold=timeold/1e3,secondsold=Math.floor(sectimeold),msPerDay=864e5,e_daysold=timeold/msPerDay,daysold=Math.floor(e_daysold),e_hrsold=24*(e_daysold-daysold),hrsold=setzero(Math.floor(e_hrsold)),e_minsold=60*(e_hrsold-hrsold),minsold=setzero(Math.floor(60*(e_hrsold-hrsold))),seconds=setzero(Math.floor(60*(e_minsold-minsold))),document.getElementById("days").innerHTML="我的小站已运行"+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒"}function setzero(e){return e=e<10?"0"+e:e}show_date_time()</script><!-- reward --></div><!-- copyright --><div class=declare><ul class=post-copyright><li><i class=ri-copyright-line></i> <strong>版权声明： </strong>本博客所有文章除特别声明外，著作权归作者所有。转载请注明出处！</li></ul></div><footer class=article-footer><div class=share-btn><span class="share-sns share-outer"><i class=ri-share-forward-line></i> 分享</span><div class=share-wrap><i class=arrow></i><div class=share-icons><a class="weibo share-sns" href=javascript:; data-type=weibo><i class=ri-weibo-fill></i> </a><a class="weixin share-sns wxFab" href=javascript:; data-type=weixin><i class=ri-wechat-fill></i> </a><a class="qq share-sns" href=javascript:; data-type=qq><i class=ri-qq-fill></i> </a><a class="douban share-sns" href=javascript:; data-type=douban><i class=ri-douban-line></i> </a><!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> --> <a class="facebook share-sns" href=javascript:; data-type=facebook><i class=ri-facebook-circle-fill></i> </a><a class="twitter share-sns" href=javascript:; data-type=twitter><i class=ri-twitter-fill></i> </a><a class="google share-sns" href=javascript:; data-type=google><i class=ri-google-fill></i></a></div></div></div><div class=wx-share-modal><a class=modal-close href=javascript:;><i class=ri-close-circle-line></i></a><p>扫一扫，分享到微信</p><div class=wx-qrcode><img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://fireman-34.github.io/2022/hexo%E6%B7%B1%E5%85%A5%E5%86%8D%E5%AD%A6%E4%B9%A0/" alt=微信分享二维码></div></div><div id=share-mask></div><ul class=article-tag-list itemprop=keywords><li class=article-tag-list-item><a class=article-tag-list-link href=/tags/hexo/ rel=tag>hexo</a></li></ul></footer></div><nav class=article-nav><a href=/2022/study-from-%E4%BA%91%E6%B8%B8%E5%90%9B/ class=article-nav-link><strong class=article-nav-caption>上一篇</strong><div class=article-nav-title>study-from-云游君</div></a><a href=/2022/hexo%E5%8D%9A%E5%AE%A2%E9%83%A8%E7%BD%B2/ class=article-nav-link><strong class=article-nav-caption>下一篇</strong><div class=article-nav-title>hexo博客部署</div></a></nav></article></section><footer class=footer><div class=outer><ul><li>Copyrights &copy; 2022 <i class="ri-heart-fill heart_icon"></i> Ma</li></ul><ul><li></li></ul><ul><li><span><span><i class=ri-user-3-fill></i>访问人数:<span id=busuanzi_value_site_uv></span></span> <span class=division>|</span> <span><i class=ri-eye-fill></i>浏览次数:<span id=busuanzi_value_page_pv></span></span></span></li></ul><ul></ul><ul></ul><ul><li><!-- cnzz统计 --><script type=text/javascript src="https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914"></script></li></ul></div></footer></main><div class=float_btns><div class=totop id=totop><i class=ri-arrow-up-line></i></div><div class=todark id=todark><i class=ri-moon-line></i></div></div><aside class="sidebar on"><button class=navbar-toggle aria-label="a button can opend or hide navbar"></button><nav class=navbar><div class=logo><a href=/ ><img src=/images/fire.png alt=我的博客></a></div><ul class="nav nav-main"><li class=nav-item><a class=nav-item-link href=/ >主页</a></li><li class=nav-item><a class=nav-item-link href=/archives>归档</a></li><li class=nav-item><a class=nav-item-link href=/categories>分类</a></li><li class=nav-item><a class=nav-item-link href=/tags>标签</a></li><li class=nav-item><a class=nav-item-link href=/friends>友链</a></li><li class=nav-item><a class=nav-item-link href=/about>关于我</a></li><li class=nav-item><a class=nav-item-link href=/changeLog>更新日志</a></li><li class=nav-item><a class=nav-item-link href=/representations>总结</a></li></ul></nav><nav class="navbar navbar-bottom"><ul class=nav><li class=nav-item><a class="nav-item-link nav-item-search" title=搜索><i class=ri-search-line></i></a></li></ul></nav><div class=search-form-wrap><div class="local-search local-search-plugin"><input type=search id=local-search-input class=local-search-input placeholder=Search...><div id=local-search-result class=local-search-result></div></div></div><p class=leaves></p></aside><div id=mask></div><!-- #reward --><div id=reward><span class=close><i class=ri-close-line></i></span><p class=reward-p><i class=ri-cup-line></i>请我喝杯咖啡吧~</p><div class=reward-box><div class=reward-item><img class=reward-img src=/images/alipay.jpg> <span class=reward-type>支付宝</span></div><div class=reward-item><img class=reward-img src=/images/wechat.jpg> <span class=reward-type>微信</span></div></div></div><script src=/js/jquery-3.6.0.min.js></script><script src=/js/lazyload.min.js></script><!-- Tocbot --><script src=/js/tocbot.min.js></script><script>tocbot.init({tocSelector:".tocbot",contentSelector:".article-entry",headingSelector:"h1, h2, h3, h4, h5, h6",hasInnerContainers:!0,scrollSmooth:!0,scrollContainer:"main",positionFixedSelector:".tocbot",positionFixedClass:"is-position-fixed",fixedSidebarOffset:"auto"})</script><script src=https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js></script><link rel=stylesheet href=https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css><script src=https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js></script><script src=/dist/main.js></script><!-- ImageViewer --><!-- MathJax --><!-- Katex --><!-- busuanzi  --><script src=/js/busuanzi-2.3.pure.min.js></script><!-- ClickLove --><!-- ClickBoom1 --><!-- ClickBoom2 --><!-- CodeCopy --><link rel=stylesheet href=/css/clipboard.css><script src=https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js></script><script>function wait(e,i){window.setTimeout(e,i)}!function(){var e;e="",e+='<button class="btn-copy" data-clipboard-snippet=""><i class="ri-file-copy-2-line"></i><span>COPY</span></button>',$(".highlight .code pre").before(e),$(".article pre code").before(e),(e=new ClipboardJS(".btn-copy",{target:function(e){return e.nextElementSibling}})).on("success",function(e){let i=$(e.trigger),n=(i.addClass("copied"),$(i.find("i"))),l=(n.removeClass("ri-file-copy-2-line"),n.addClass("ri-checkbox-circle-line"),$(i.find("span")));l[0].innerText="COPIED",wait(function(){n.removeClass("ri-checkbox-circle-line"),n.addClass("ri-file-copy-2-line"),l[0].innerText="COPY"},2e3)}),e.on("error",function(e){e.clearSelection();let i=$(e.trigger),n=(i.addClass("copy-failed"),$(i.find("i"))),l=(n.removeClass("ri-file-copy-2-line"),n.addClass("ri-time-line"),$(i.find("span")));l[0].innerText="COPY FAILED",wait(function(){n.removeClass("ri-time-line"),n.addClass("ri-file-copy-2-line"),l[0].innerText="COPY"},2e3)})}((window,document))</script><!-- CanvasBackground --><script>window.mermaid&&mermaid.initialize({theme:"forest"})</script></div><div id=addShowdowOnPC></div><script async>class ScrollEvent{constructor({delayTime:e,time:t,handler:o,element:i=window}){if(!o)throw new Error("handler is required");this.delayTime=e,this.time=t,this.handler=o,this.element=i,this.curry=this.curryHandler()}curryHandler(){const t=this.delayTime,o=this.time;let i=!1,n=null;return t&&!o?e=>{n=n||setTimeout(()=>{this.handler(e),clearTimeout(n),n=null},t)}:!t&&o?e=>{i&&(this.handler(e),i=!0,setTimeout(()=>i=!1,o))}:void 0}mounted(){this.element.addEventListener("scroll",this.curry)}destory(){this.element.removeEventListener("scroll",this.handler)}}function isMobile(){return!!window.navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec   wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)}function addCSS(e,t=document.body){if(document.all)window.style=e,document.createSleSheet("javascript:style");else{const o=document.createElement("style");o.type="text/css",o.innerHTML=e,t.appendChild(o)}}if(!isMobile()){const n=`.article{
    box-shadow: 0 0 3px #657b83;
    -webkit-box-shadow:0 0 3px #657b83;
    -moz-box-shadow:0 0 3px #657b83;
    padding: 2em !important;
    margin: 2em;
  }.article:hover{
    box-shadow: 0 0 7px #657b83;
    -webkit-box-shadow:0 0 7px #657b83;
    -moz-box-shadow:0 0 7px #657b83;
  }`;let e=!0;const p=document.querySelector("main.content.on");addCSS(n)}</script></body>